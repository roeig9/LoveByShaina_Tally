<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1, width=device-width" />
    <style>
      #map {
        width: 100%;
        height: 400px;
        position: relative;
      }

      /* Move zoom controls to bottom-right */
      .gm-bundled-control.gm-bundled-control-on-bottom {
        bottom: 20px !important;
        right: 20px !important;
        top: auto !important;
        left: auto !important;
      }
    </style>
  </head>

  <body>
    <div id="map"></div>

    <script>
      let map, circle, selectedLat, selectedLng;

      function initMap() {
        map = new google.maps.Map(document.getElementById("map"), {
          center: { lat: 32.0853, lng: 34.7818 },
          zoom: 14,
          disableDefaultUI: false,
          zoomControl: true,
        });

        // Add circle on click
        map.addListener("click", (e) => {
          selectedLat = e.latLng.lat();
          selectedLng = e.latLng.lng();

          if (circle) circle.setMap(null);

          circle = new google.maps.Circle({
            center: { lat: selectedLat, lng: selectedLng },
            radius: 30,
            fillColor: "#4285F4",
            fillOpacity: 0.3,
            strokeColor: "#4285F4",
            strokeOpacity: 0.8,
            strokeWeight: 2,
            map,
          });

          // Auto-update Tally hidden field (no extra button)
          window.parent.postMessage(
            {
              type: "tally:setAnswer",
              payload: {
                fieldId: "location",
                value: `${selectedLat},${selectedLng}`,
              },
            },
            "*"
          );
        });
      }
    </script>

    <script
      src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=initMap"
      async
      defer
    ></script>
  </body>
</html>
